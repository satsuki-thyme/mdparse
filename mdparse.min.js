function mdparse(e,t){function n(e){let t=[],n=[],l=0,r=0;return new Promise(s=>{function a(){t[r]={};let c=e[r].match(/^(?:\t| {4})+/);if(t[r].indent=null===c?0:c[0].match(/\t| {4}/g).length,!1===m&&!0===/^$/.test(e[r]))t[r].class="blank",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^#{1,6} /.test(e[r]))t[r].class="h",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!1===/^(#{1,6}|\* |\+ |- |\d+\. |( {4,}|\t)(?!\\)|```|~~~|>+ |\||\[\^.+?\]: ?).*$|^[ \t]*(?!\\)([*\-_][ \t]*){3,}$/.test(e[r]))t[r].class="p",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^(\t| {4})*(?<!\\)[*+\-] (?!\[[ x]\] )/.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ul",t[r].task=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^(\t| {4})*(?<!\\)\d+\. /.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ol",t[r].task=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^(\t| {4})*(?<!\\)[*+\-] \[[ x]\] /.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ul",t[r].task=!0,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^>+ /.test(e[r]))t[r].class="bq",t[r].stack=e[r].match(/^>+/)[0].match(/>/g).length,r<e.length-1?(r++,a()):s([e,t,n]);else if(!0===/^```|^~~~/.test(e[r]))t[r].class="preEncl",t[r].site="end",!1===m?(m=!0,t[r].preGrp=r,G[r]=e[r].replace(/```[ \t]*/,"")):m=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!0===m&&!1===/^```|^~~~/.test(e[r]))t[r].class="preEncl",t[r].site="middle",t[r].preGrp=t[r-1].preGrp,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&(!0===/^(\t| {4})+(?!(\*|\+|-|\d+\.) |([*\-_][ \t]*){3,})/.test(e[r])||0===r&&!0===/^(\t| {4})+((\*|\+|-|\d+\.) )/.test(e[r])||0!==r&&"li"!==t[r].class&&!0===/^(\t| {4})+((\*|\+|-|\d+\.) )/.test(e[r])))t[r].class="preInd",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===m&&!0===/^\|/.test(e[r])){t[r].class="table";let c=!1;if(!0===/^(\| ?:?-+:? ?)+\|/.test(e[r])&&(c=!0),r>0&&"table"===t[r-1].class?(t[r].tableGrp=t[r-1].tableGrp,!1===c&&(l++,t[r].rowNum=l)):(n.push({}),t[r].tableGrp=n.length-1,n[t[r].tableGrp].hLineAlready=!1,n[t[r].tableGrp].hLinePosition=0,!1===c&&(l=0,t[r].rowNum=0)),!1===c)t[r].hLine=!1;else if(t[r].hLine=!0,!1===n[t[r].tableGrp].hLineAlready){n[t[r].tableGrp].hLineAlready=!0;let l=$(e[r]);n[t[r].tableGrp].align=`class="user-cnt-table-${l}" align="${l}"`,0===r||"table"!==t[r-1].class?n[t[r].tableGrp].hLinePosition=0:n[t[r].tableGrp].hLinePosition=t[r-1].rowNum+1}r<e.length-1?(r++,a()):s([e,t,n])}else!1===m&&!0===/(?<!\\(\\\\)*)\[.+?\]: /.test(e[r])?(t[r].class="footnote",r<e.length-1?(r++,a()):s([e,t,n])):!1===m&&!0===/^[ \t]*(?<!\\(\\\\)*)([*\-_][ \t]*){3,}$/.test(e[r])?(t[r].class="hr",r<e.length-1?(r++,a()):s([e,t,n])):(t[r].class="unmatched",r<e.length-1?(r++,a()):s([e,t,n]))}a()})}function l(e){let t=/^\/?(html|head|title|base|link|style|meta|body|article|section|nav|aside|h1|h2|h3|h4|h5|h6|header|footer|address|p|hr|pre|blockquote|ol|ul|li|dl|dt|dd|figure|figcaption|main|div|a|em|strong|small|s|cite|q|dfn|abbr|code|var|samp|kbd|data|sub|sup|time|i|b|u|mark|ruby|rb|rt|rtc|rp|bdi|bdo|span|br|wbr|ins|del|img|picture|iframe|embed|object|param|video|audio|track|source|map|area|table|caption|colgroup|col|tbody|thead|tfoot|tr|td|th|form|fieldset|legend|label|input|select|option|optgroup|textarea|button|datalist|output|progress|meter|script|noscript|template|canvas|details|summary|menu|menuitem)$/;for(let n in e[1])"preEncl"===e[1][n].class||"preInd"===e[1][n].class?e[0][n]=e[0][n].replace(/<.+?>/g,e=>t.test(e.match(/(?<=<).+?(?=>)/)[0])?e:e.replace(/<(\/?.*)>/g,"&lt;$1&gt;")):e[0][n]=e[0][n].replace(/(?<!\\(?:\\\\)*)\\<(.*?)>/g,"&lt;$1&gt;").replace(/(?<!\\(?:\\\\)*)\\</g,"&lt;").replace(/(?<!\\(?:\\\\)*)\\>/g,"&gt;").replace(/(?<!\\(?:\\\\)*)\\(.)/g,"$1").replace(/\\\\/g,"\\");return[e[0],e[1],e[2]]}function r(e){let n=e[0],l=e[1],r=e[2],s=0;return!0===m&&(n.push("```"),l.push({class:"preEncl",site:"end"})),new Promise(e=>{function a(){switch("preEncl"!==l[s].class&&(n[s]=n[s].replace(/(?<!\\(?:\\\\)*|`)`(?!.*<br>)(.+)(?<!\\(?:\\\\)*|`)`/g,e=>`<code>${e.replace(/`/g,"")}</code>`)),l[s].class){case"blank":s<l.length-1?(s++,a()):e([n,l]);break;case"h":n[s]=c(n,s),s<l.length-1?(s++,a()):e([n,l]);break;case"p":s===l.length-1||"p"!==l[s+1].class||"permissive"===t?(n[s]=`<p>${n[s]}</p>`,s<l.length-1?(s++,a()):e([n,l])):(n[s+1]=`${n[s]}${i(n[s])}${n[s+1]}`,n=n.slice(0,s).concat(n.slice(s+1)),l=l.slice(0,s).concat(l.slice(s+1)),s<l.length-1?a():e([n,l]));break;case"li":n[s]=p(n,l,s),s<l.length-1?(s++,a()):e([n,l]);break;case"bq":n[s]=h(n,l,s),s<l.length-1?(s++,a()):e([n,l]);break;case"preEncl":"middle"===l[s].site?u(n,l,s).then(t=>{n[s]=t,s<l.length-1?(s++,a()):e([n,l])}):(n=n.slice(0,s).concat(n.slice(s+1)),l=l.slice(0,s).concat(l.slice(s+1)),s<l.length-1?a():e([n,l]));break;case"preInd":n[s]=g(n,l,s),s<l.length-1?(s++,a()):e([n,l]);break;case"table":!1===l[s].hLine?b(n,l,r,s).then(t=>{n[s]=t,s<l.length-1?(s++,a()):e([n,l])}):(n=n.slice(0,s).concat(n.slice(s+1)),l=l.slice(0,s).concat(l.slice(s+1)),s<l.length-1?a():e([n,l]));break;case"footnote":w.push({key:n[s].match(/(?<=\[\^).+?(?=\]: )/)[0],word:n[s].replace(/\[\^.+?\]: /,"")}),n=n.slice(0,s).concat(n.slice(s+1)),l=l.slice(0,s).concat(l.slice(s+1)),s<l.length-1?a():e([n,l]);break;case"hr":n[s]="<hr>",s<l.length-1?(s++,a()):e([n,l]);break;case"unmatched":console.log(`unmatched at line ${s}\n${n[s]}`),s<l.length-1?(s++,a()):e([n,l]);break;default:console.log("unexpected error")}}a()})}function s(e){return e[0].filter(e=>0!==e.length).map(e=>e.replace(/(?<!\\(?:\\\\)*|_)_(?!_|.*<br>)(.+?)(?<!_|\\(?:\\\\)*)_(?!_)/g,"<em>$1</em>").replace(/(?<!\\(?:\\\\)*|_)__(?!_|.*<br>)(.+?)(?<!_|\\(?:\\\\)*)__(?!_)/g,"<strong>$1</strong>").replace(/(?<!\\(?:\\\\)*)___(?!.*<br>)(.+?)(?<!\\(?:\\\\)*)___/g,"<strong><em>$1</em></strong>").replace(/(?<!\\(?:\\\\)*|\*)\*(?!\*|.*<br>)(.+?)(?<!\*|\\(?:\\\\)*)\*(?!\*)/g,"<em>$1</em>").replace(/(?<!\\(?:\\\\)*|\*)\*\*(?!\*|.*<br>)(.+?)(?<!\*|\\(?:\\\\)*)\*\*(?!\*)/g,"<strong>$1</strong>").replace(/(?<!\\(?:\\\\)*)\*\*\*((?!.*<br>).+?)(?<!\\(?:\\\\)*)\*\*\*/g,"<strong><em>$1</em></strong>").replace(/(?<!\\(?:\\\\)*|~)~~(?!~|.*<br>)(.+?)(?<!\\(?:\\\\)*)~~(?!~)/g,"<del>$1</del>").replace(/(?<!\\(?:\\\\)*|!)\[(?!.*<br>)(.+?)(?<!\\(?:\\\\)*)\]\((.+?)\)/g,'<a href="$2">$1</a>').replace(/(?<!\\(?:\\\\)*)!\[(?!.*<br>)(.+?)(?<!\\(?:\\\\)*)\]\((.+?)\)/g,'<img src="$2" alt="$1">'))}function a(e){function t(e){let t=e;for(let e=0;e<c.length;e++){let n=new RegExp(`\\[\\^${c[e]}\\]`);for(let l=0;l<o.length;l++)c[e]===o[l]&&(t=t.replace(n,`<sup>[<a id="user-cnt-funref-${e}" href="#user-cnt-fun-${l}">${l+1}</a>]</sup>`))}return t}function n(){let e=[];for(let t in i)for(let n=0;n<w.length;n++)i[t]===w[n].key&&(e.push(w[n]),w=w.slice(0,n).concat(w.slice(n+1)));for(let t in w)e.push(w[t]);return e}function l(e){let t=[],n=e.match(/\[\^.+?\]/g);if(null!==n)for(let e in n)t.push(n[e].replace(/\[\^|\]/g,""));return t}function r(){let e=[];for(let t in p)e.push(`<li id="user-cnt-fun-${t}"><p>${p[t].word.replace(/^\[[^\]]+\]: /g,"")}${d[t].join("")}</p></li>`);return e.join("")}function s(){let e=[];for(let t in p){e[t]=[];for(let n in c)p[t].key===c[n]&&e[t].push(` <a href="#user-cnt-funref-${n}">${y}</a>`)}return e}let a=e.join(""),c=l(a),i=Array.from(new Set(c)),p=n(),o=[];for(let e in p)o.push(p[e].key);o=Array.from(new Set(o));let d=s(),h=t(a),u=r();return""===u||0===c.length?h:`${h}<section class="footnotes"><ol>${u}</ol></section>`}function c(e,t){let n=e[t].match(/^#+/)[0].match(/#/g).length;return`<h${n}>${e[t].replace(/^#+ /,"")}</h${n}>`}function i(e){return!1===/<br>$/.test(e)?" ":""}function p(e,t,n){return n>0&&n<t.length-1&&"li"===t[n-1].class&&(t[n].indent<t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent===t[n-1].parent)&&"li"===t[n+1].class&&(t[n].indent<t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent===t[n+1].parent)?`${o(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>`:(0===n||"li"!==t[n-1].class||t[n].indent>t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent!==t[n-1].parent||t[n].indent<t[n-1].indent&&t[n].parent!==k[k.length-1])&&n<t.length-1&&"li"===t[n+1].class&&(t[n].indent<t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent===t[n+1].parent)?(k.push(t[n].parent),`<${t[n].parent}>${o(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>`):(n===t.length-1||"li"!==t[n+1].class||t[n].indent>t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent!==t[n+1].parent)&&0!==n&&"li"===t[n-1].class&&(t[n].indent<t[n-1].indent&&t[n].parent===k[k.length-1]||t[n].indent===t[n-1].indent&&t[n].parent===t[n-1].parent)?`${o(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>${d(t,n)}`:(0===n||"li"!==t[n-1].class||t[n].indent>t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent!==t[n-1].parent||t[n].indent<t[n-1].indent&&t[n].parent!==k[k.length-1])&&(n===t.length-1||"li"!==t[n+1].class||t[n].indent>t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent!==t[n+1].parent)?(k.push(t[n].parent),`<${t[n].parent}>${o(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>${d(t,n)}`):void 0}function o(e,t,n){return!1===t[n].task?"<li>":!0===/^.*\[ \]/.test(e[n])?'<li class="user-cnt-tasklist"><input type="checkbox"> ':'<li class="user-cnt-tasklist"><input type="checkbox" checked> '}function d(e,t){let n="";if(t===e.length-1||"li"!==e[t+1].class||0===e[t+1].indent&&e[t+1].parent!==k[0])return n=`</${k.reverse().join("></")}>`,k=[],n;if(t<e.length-1&&"li"===e[t+1].class&&e[t].indent>e[t+1].indent){let l=e[t+1].indent-e[t].indent;return n=`</${k.slice(l).reverse().join("></")}>`,k=k.slice(0,k.length+l),n}return t<e.length-1&&"li"===e[t+1].class&&e[t].indent===e[t+1].indent&&0!==e[t+1].indent&&e[t].parent!==e[t+1].parent?(n=`</${k.slice(-1)}>`,k=k.slice(0,k.length-1),n):void 0}function h(e,t,n){if(n>0&&n<t.length-1&&t[n].stack<=t[n-1].stack&&t[n].stack<=t[n+1].stack)return e[n].replace(/^>+ /,"");if((0===n||"bq"!==t[n-1].class||t[n].stack>t[n-1].stack)&&n<t.length-1&&"bq"===t[n+1].class){let l="";return l="bq"!==t[n-1].class?`${"<blockquote>".repeat(t[n].stack)}<p>`:`${"<blockquote>".repeat(t[n].stack-t[n-1].stack)}<p>`,`${l}${e[n].replace(/^>+ /,"")}`}if((n===t.length-1||"bq"!==t[n+1].class||t[n].stack>t[n+1].stack)&&n>0&&"bq"===t[n-1].class){let l="";return l="bq"!==t[n+1].class?`${"</blockquote>".repeat(t[n].stack)}</p>`:`${"</blockquote>".repeat(t[n].stack-t[n+1].stack)}</p>`,`${e[n].replace(/^>+ /,"")}${l}`}if((0===n||"bq"!==t[n-1].class||t[n].stack>t[n-1].stack)&&(n===t.length-1||"bq"!==t[n+1].class||t[n].stack>t[n+1].stack)){let l="",r="";return l="bq"!==t[n-1].class?`${"<blockquote>".repeat(t[n].stack)}<p>`:`${"<blockquote>".repeat(t[n].stack-t[n-1].stack)}<p>`,r="bq"!==t[n+1].class?`${"</blockquote>".repeat(t[n].stack)}</p>`:`${"</blockquote>".repeat(t[n].stack-t[n+1].stack)}</p>`,`${l}${e[n].replace(/^>+ /,"")}${r}`}}async function u(e,t,n){return n>0&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp&&n<t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?`\n${e[n]}`:(0===n||"preEncl"!==t[n-1].class||t[n-1].preGrp!==t[n].preGrp)&&n<t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?""!==G[t[n].preGrp]?`<pre><code class="language-${G[t[n].preGrp]}">${e[n]}`:`<pre><code>${e[n]}`:(n===t.length-1||"preEncl"!==t[n+1].class||t[n+1].preGrp!==t[n].preGrp)&&n>0&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp?`${e[n]}</code></pre>`:0!==n&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp||n!==t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?void 0:""!==G[t[n].preGrp]?`<pre><code class="language-${G[t[n].preGrp]}">${e[n]}`:`<pre><code>${e[n]}`}function g(e,t,n){return n>0&&"preInd"===t[n-1].class&&n<t.length-1&&"preInd"===t[n+1].class?`${e[n].replace(/^\t|^ {4}/,"")}`:0===n||"preInd"!==t[n-1].class&&n<t.length-1&&"preInd"===t[n+1].class?`<pre><code">${e[n].replace(/^\t|^ {4}/,"")}`:n===t.length-1||"preInd"!==t[n+1].class&&n>0&&"preInd"===t[n-1].class?`${e[n].replace(/^\t|^ {4}/,"")}</code></pre>`:0!==n&&"preInd"===t[n-1].class||n!==t.length-1&&"preInd"===t[n+1].class?void 0:`<pre><code>${e[n].replace(/^\t|^ {4}/,"")}</code></pre>`}async function b(e,t,n,l){if(l>0&&"table"===t[l-1].class&&l<t.length-1&&"table"===t[l+1].class){if(n[t[l].tableGrp].hLinePosition===t[l].rowNum+1)return`${f(e,t,n,l)}</thead>`;if(n[t[l].tableGrp].hLinePosition===t[l].rowNum)return`<tbody>${f(e,t,n,l)}`;if(n[t[l].tableGrp].hLinePosition!==t[l].rowNum+1&&n[t[l].tableGrp].hLinePosition!==t[l].rowNum)return`${f(e,t,n,l)}`}if((0===l||"table"!==t[l-1].class)&&l<t.length&&"table"===t[l+1].class){if(0===n[t[l].tableGrp].hLinePosition)return`<table><tbody>${f(e,t,n,l)}`;if(1===n[t[l].tableGrp].hLinePosition)return`<table><thead>${f(e,t,n,l)}</thead>`;if(n[t[l].tableGrp].hLinePosition>1)return`<table><thead>${f(e,t,n,l)}`}if((l===t.length-1||"table"!==t[l+1].class)&&l>0&&"table"===t[l-1].class){if(n[t[l].tableGrp].hLinePosition===t[l].rowNum+1)return`${f(e,t,n,l)}</thead></table>`;if(n[t[l].tableGrp].hLinePosition===t[l].rowNum)return`<tbody>${f(e,t,n,l)}</tbody></table>`;if(n[t[l].tableGrp].hLinePosition!==t[l].rowNum+1&&n[t[l].tableGrp].hLinePosition!==t[l].rowNum)return`${f(e,t,n,l)}</tbody></table>`}if(!(0!==l&&"table"===t[l-1].class||l!==t.length-1&&"table"===t[l+1].class)){if(n[t[l].tableGrp].hLinePosition===l-t[l].tableGrp+1)return`<table><thead>${f(e,t,n,l)}</thead></table>`;if(n[t[l].tableGrp].hLinePosition===l-t[l].tableGrp)return`<table><tbody>${f(e,t,n,l)}</tbody></table>`}}function $(e){let t=e.split("|");return t.splice(1,t.length-2).map(e=>!0===/^ ?:-+ ?$/.test(e)?"left":!0===/^ ?:-+: ?$/.test(e)?"center":!0===/^ ?-+: ?$/.test(e)?"right":!0===/^ ?-+ ?$/.test(e)?"":void 0)}function f(e,t,n,l){let r=e[l].split(/[ \t]*(?<!\\)\|[ \t]*/);return"<tr>"+r.splice(1,r.length-2).map((e,r)=>`<td ${n[t[l].tableGrp].align[r]}>${e}</td>`).join("")+"</tr>"}let k=[],m=!1,G={},w=[],y='<svg class="user-cnt-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0, 0, 16, 21"><path d="M 0,0 V 2 h 8 c 3,0 6,3 6,6 0,3 -3,6 -6,6 H 7 v 2 h 1 c 4,0 8,-4 8,-8 0,-4 -4,-8 -8,-8 z"/><path d="M 6,21 7,19 3,15 7,11 6,9 0,15 Z"/></svg>';return n(e.replace(/  \r?\n/g,"<br>").split(/\r?\n/)).then(e=>l(e)).then(e=>r(e)).then(e=>s(e)).then(e=>a(e))}