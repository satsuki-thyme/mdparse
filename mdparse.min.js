function mdparse(e,t){function n(e){let t=[],n=[],l=0,r=0;return new Promise(s=>{function a(){t[r]={};let c=e[r].match(/^(?:\t| {4})+/);if(t[r].indent=null===c?0:c[0].match(/\t| {4}/g).length,!1===w&&!0===/^$/.test(e[r]))t[r].class="blank",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^#{1,6} /.test(e[r]))t[r].class="h",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!1===/^(#{1,6}|\* |\+ |- |\d+\. |( {4,}|\t)(?!\\)|```|~~~|>+ |\||\[\^.+?\]: ?).*$|^[ \t]*(?!\\)([*\-_][ \t]*){3,}$/.test(e[r]))t[r].class="p",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^(\t| {4})*[*+\-] (?!\[[ x]\] )/.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ul",t[r].task=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^(\t| {4})*\d+\. /.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ol",t[r].task=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^(\t| {4})*[*+\-] \[[ x]\] /.test(e[r])&&(0===r&&0===t[r].indent||r>0&&("li"===t[r-1].class&&t[r].indent-t[r-1].indent<=1||"li"!==t[r-1].class&&0===t[r].indent)))t[r].class="li",t[r].parent="ul",t[r].task=!0,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^>+ /.test(e[r]))t[r].class="bq",t[r].stack=e[r].match(/^>+/)[0].match(/>/g).length,r<e.length-1?(r++,a()):s([e,t,n]);else if(!0===/^```|^~~~/.test(e[r]))t[r].class="preEncl",t[r].site="end",!1===w?(w=!0,t[r].preGrp=r):w=!1,r<e.length-1?(r++,a()):s([e,t,n]);else if(!0===w&&!1===/^```|^~~~/.test(e[r]))t[r].class="preEncl",t[r].site="middle",t[r].preGrp=t[r-1].preGrp,r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^(\t| {4})+(?!([*\-_][ \t]*){3,}$)/.test(e[r])&&(!1===/^(\*|\+|-|\d+\.) /.test(e[r])||r!==t.length-1&&"li"!==t[r-1]))t[r].class="preInd",r<e.length-1?(r++,a()):s([e,t,n]);else if(!1===w&&!0===/^\|/.test(e[r])){t[r].class="table";let c=!1;if(!0===/^(\| ?:?-+:? ?)+\|/.test(e[r])&&(c=!0),r>0&&"table"===t[r-1].class?(t[r].tableGrp=t[r-1].tableGrp,!1===c&&(l++,t[r].rowNum=l)):(n.push({}),t[r].tableGrp=n.length-1,n[t[r].tableGrp].hLineAlready=!1,n[t[r].tableGrp].hLinePosition=0,!1===c&&(l=0,t[r].rowNum=0)),!1===c)t[r].hLine=!1;else if(t[r].hLine=!0,!1===n[t[r].tableGrp].hLineAlready){n[t[r].tableGrp].hLineAlready=!0;let l=k(e[r]);n[t[r].tableGrp].align=`class="user-cnt-table-${l}" align="${l}"`,0===r||"table"!==t[r-1].class?n[t[r].tableGrp].hLinePosition=0:n[t[r].tableGrp].hLinePosition=t[r-1].rowNum+1}r<e.length-1?(r++,a()):s([e,t,n])}else!1===w&&!0===/\[.+?\]: /.test(e[r])?(t[r].class="footnote",r<e.length-1?(r++,a()):s([e,t,n])):!1===w&&!0===/^[ \t]*(?!\\)([*\-_][ \t]*){3,}$/.test(e[r])?(t[r].class="hr",r<e.length-1?(r++,a()):s([e,t,n])):(t[r].class="unmatched",r<e.length-1?(r++,a()):s([e,t,n]))}a()})}function l(e){for(let t in e[1])"preEncl"!==e[1][t].class&&"preInd"!==e[1][t].class||(e[0][t]=r(e[0][t])),e[0][t]=s(e[0][t]);return[e[0],e[1],e[2]]}function r(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/â€œ/g,"&quot;").replace(/ /g,"&nbsp;")}function s(e){return e.replace(/(?<!\\)\\</g,"&lt;").replace(/(?<!\\)\\>/g,"&gt;").replace(/(?<!\\)(?<=\\<)(.*?)>/g,"$1&gt;")}function a(e){let n=e[0],l=e[1],s=e[2],a=0;return!0===w&&(n.push("```"),l.push({class:"preEncl",site:"end"})),new Promise(e=>{function c(){switch("preEncl"!==l[a].class&&(n[a]=n[a].replace(/(?<!\\)`(?!.*<br>)(.+)`/g,e=>`<code>${r(e.replace(/`/g,""))}</code>`)),l[a].class){case"blank":a<l.length-1?(a++,c()):e([n,l]);break;case"h":n[a]=p(n,a),a<l.length-1?(a++,c()):e([n,l]);break;case"p":a===l.length-1||"p"!==l[a+1].class||"permissive"===t?(n[a]=`<p>${n[a]}</p>`,a<l.length-1?(a++,c()):e([n,l])):(n[a+1]=`${n[a]}${o(n[a])}${n[a+1]}`,n=n.slice(0,a).concat(n.slice(a+1)),l=l.slice(0,a).concat(l.slice(a+1)),a<l.length-1?c():e([n,l]));break;case"li":n[a]=h(n,l,a),a<l.length-1?(a++,c()):e([n,l]);break;case"bq":n[a]=g(n,l,a),a<l.length-1?(a++,c()):e([n,l]);break;case"preEncl":"middle"===l[a].site?b(n,l,a).then(t=>{n[a]=t,a<l.length-1?(a++,c()):e([n,l])}):(n=n.slice(0,a).concat(n.slice(a+1)),l=l.slice(0,a).concat(l.slice(a+1)),a<l.length-1?c():e([n,l]));break;case"preInd":n[a]=$(n,l,a),a<l.length-1?(a++,c()):e([n,l]);break;case"table":!1===l[a].hLine?f(n,l,s,a).then(t=>{n[a]=t,a<l.length-1?(a++,c()):e([n,l])}):(n=n.slice(0,a).concat(n.slice(a+1)),l=l.slice(0,a).concat(l.slice(a+1)),a<l.length-1?c():e([n,l]));break;case"footnote":_.push({key:n[a].match(/(?<=\[\^).+?(?=\]: )/)[0],word:n[a].replace(/\[\^.+?\]: /,"")}),n=n.slice(0,a).concat(n.slice(a+1)),l=l.slice(0,a).concat(l.slice(a+1)),a<l.length-1?c():e([n,l]);break;case"hr":n[a]="<hr>",a<l.length-1?(a++,c()):e([n,l]);break;case"unmatched":console.log(`unmatched at line ${a}\n${n[a]}`),a<l.length-1?(a++,c()):e([n,l]);break;default:console.log("unexpected error")}}c()})}function c(e){return e[0].filter(e=>0!==e.length).map(e=>e.replace(/(?<!\\|_)_(?!_|.*<br>)(.+?)(?<!_)_(?!_)/g,"<em>$1</em>").replace(/(?<!\\|_)__(?!_|.*<br>)(.+?)(?<!_)__(?!_)/g,"<strong>$1</strong>").replace(/(?<!\\)___(?!.*<br>)(.+?)___/g,"<strong><em>$1</em></strong>").replace(/(?<!\\|\*)\*(?!\*|.*<br>)(.+?)(?<!\*)\*(?!\*)/g,"<em>$1</em>").replace(/(?<!\\|\*)\*\*(?!\*|.*<br>)(.+?)(?<!\*)\*\*(?!\*)/g,"<strong>$1</strong>").replace(/(?<!\\)\*\*\*((?!.*<br>).+?)\*\*\*/g,"<strong><em>$1</em></strong>").replace(/(?<!\\|~)~~(?!~|.*<br>)(.+?)(?<!~)~~(?!~)/g,"<del>$1</del>").replace(/(?<!\\|!)\[(?!.*<br>)(.+?)(?<!\])\]\((.+?)\)/g,'<a href="$2">$1</a>').replace(/(?<!\\)!\[(?!.*<br>)(.+?)(?<!\])\]\((.+?)\)/g,'<img src="$2" alt="$1">').replace(/(?<!\\)\\(.)/g,"$1"))}function i(e){function t(e){let t=e;for(let e=0;e<c.length;e++){let n=new RegExp(`\\[\\^${c[e]}\\]`);for(let l=0;l<o.length;l++)c[e]===o[l]&&(t=t.replace(n,`<sup>[<a id="user-cnt-funref-${e}" href="#user-cnt-fun-${l}">${l+1}</a>]</sup>`))}return t}function n(){let e=[];for(let t in i)for(let n=0;n<_.length;n++)i[t]===_[n].key&&(e.push(_[n]),_=_.slice(0,n).concat(_.slice(n+1)));for(let t in _)e.push(_[t]);return e}function l(e){let t=[],n=e.match(/\[\^.+?\]/g);if(null!==n)for(let e in n)t.push(n[e].replace(/\[\^|\]/g,""));return t}function r(){let e=[];for(let t in p)e.push(`<li id="user-cnt-fun-${t}"><p>${p[t].word.replace(/^\[[^\]]+\]: /g,"")}${h[t].join("")}</p></li>`);return e.join("")}function s(){let e=[];for(let t in p){e[t]=[];for(let n in c)p[t].key===c[n]&&e[t].push(` <a href="#user-cnt-funref-${n}">${L}</a>`)}return e}let a=e.join(""),c=l(a),i=Array.from(new Set(c)),p=n(),o=[];for(let e in p)o.push(p[e].key);o=Array.from(new Set(o));let h=s(),d=t(a),u=r();return""===u||0===c.length?d:`${d}<section class="footnotes"><ol>${u}</ol></section>`}function p(e,t){let n=e[t].match(/^#+/)[0].match(/#/g).length;return`<h${n}>${e[t].replace(/^#+ /,"")}</h${n}>`}function o(e){return!1===/<br>$/.test(e)?" ":""}function h(e,t,n){return n>0&&n<t.length-1&&"li"===t[n-1].class&&(t[n].indent<t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent===t[n-1].parent)&&"li"===t[n+1].class&&(t[n].indent<t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent===t[n+1].parent)?`${d(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>`:(0===n||"li"!==t[n-1].class||t[n].indent>t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent!==t[n-1].parent||t[n].indent<t[n-1].indent&&t[n].parent!==G[G.length-1])&&n<t.length-1&&"li"===t[n+1].class&&(t[n].indent<t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent===t[n+1].parent)?(G.push(t[n].parent),`<${t[n].parent}>${d(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>`):(n===t.length-1||"li"!==t[n+1].class||t[n].indent>t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent!==t[n+1].parent)&&0!==n&&"li"===t[n-1].class&&(t[n].indent<t[n-1].indent&&t[n].parent===G[G.length-1]||t[n].indent===t[n-1].indent&&t[n].parent===t[n-1].parent)?`${d(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>${u(t,n)}`:(0===n||"li"!==t[n-1].class||t[n].indent>t[n-1].indent||t[n].indent===t[n-1].indent&&t[n].parent!==t[n-1].parent||t[n].indent<t[n-1].indent&&t[n].parent!==G[G.length-1])&&(n===t.length-1||"li"!==t[n+1].class||t[n].indent>t[n+1].indent||t[n].indent===t[n+1].indent&&t[n].parent!==t[n+1].parent)?(G.push(t[n].parent),`<${t[n].parent}>${d(e,t,n)}${e[n].replace(/^[\t ]*([*+\-]|\d+\.) (\[[ x]\] )?/,"")}</li>${u(t,n)}`):void 0}function d(e,t,n){return!1===t[n].task?"<li>":!0===/^.*\[ \]/.test(e[n])?'<li class="user-cnt-tasklist"><input type="checkbox"> ':'<li class="user-cnt-tasklist"><input type="checkbox" checked> '}function u(e,t){let n="";if(t===e.length-1||"li"!==e[t+1].class||0===e[t+1].indent&&e[t+1].parent!==G[0])return n=`</${G.reverse().join("></")}>`,G=[],n;if(t<e.length-1&&"li"===e[t+1].class&&e[t].indent>e[t+1].indent){let l=e[t+1].indent-e[t].indent;return n=`</${G.slice(l).reverse().join("></")}>`,G=G.slice(0,G.length+l),n}return t<e.length-1&&"li"===e[t+1].class&&e[t].indent===e[t+1].indent&&0!==e[t+1].indent&&e[t].parent!==e[t+1].parent?(n=`</${G.slice(-1)}>`,G=G.slice(0,G.length-1),n):void 0}function g(e,t,n){if(n>0&&n<t.length-1&&t[n].stack<=t[n-1].stack&&t[n].stack<=t[n+1].stack)return e[n].replace(/^>+ /,"");if((0===n||"bq"!==t[n-1].class||t[n].stack>t[n-1].stack)&&n<t.length-1&&"bq"===t[n+1].class){let l="";return l="bq"!==t[n-1].class?`${"<blockquote>".repeat(t[n].stack)}<p>`:`${"<blockquote>".repeat(t[n].stack-t[n-1].stack)}<p>`,`${l}${e[n].replace(/^>+ /,"")}`}if((n===t.length-1||"bq"!==t[n+1].class||t[n].stack>t[n+1].stack)&&n>0&&"bq"===t[n-1].class){let l="";return l="bq"!==t[n+1].class?`${"</blockquote>".repeat(t[n].stack)}</p>`:`${"</blockquote>".repeat(t[n].stack-t[n+1].stack)}</p>`,`${e[n].replace(/^>+ /,"")}${l}`}if((0===n||"bq"!==t[n-1].class||t[n].stack>t[n-1].stack)&&(n===t.length-1||"bq"!==t[n+1].class||t[n].stack>t[n+1].stack)){let l="",r="";return l="bq"!==t[n-1].class?`${"<blockquote>".repeat(t[n].stack)}<p>`:`${"<blockquote>".repeat(t[n].stack-t[n-1].stack)}<p>`,r="bq"!==t[n+1].class?`${"</blockquote>".repeat(t[n].stack)}</p>`:`${"</blockquote>".repeat(t[n].stack-t[n+1].stack)}</p>`,`${l}${e[n].replace(/^>+ /,"")}${r}`}}async function b(e,t,n){return n>0&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp&&n<t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?`\n${e[n]}`:(0===n||"preEncl"!==t[n-1].class||t[n-1].preGrp!==t[n].preGrp)&&n<t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?`<pre><code>${e[n]}`:(n===t.length-1||"preEncl"!==t[n+1].class||t[n+1].preGrp!==t[n].preGrp)&&n>0&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp?`\n${e[n]}</code></pre>`:0!==n&&"preEncl"===t[n-1].class&&t[n-1].preGrp===t[n].preGrp||n!==t.length-1&&"preEncl"===t[n+1].class&&t[n+1].preGrp===t[n].preGrp?void 0:`<pre><code>${e[n]}</code></pre>`}function $(e,t,n){return n>0&&"preInd"===t[n-1].class&&n<t.length-1&&"preInd"===t[n+1].class?`\n${e[n].replace(/^\t|^ {4}/,"")}`:0===n||"preInd"!==t[n-1].class&&n<t.length-1&&"preInd"===t[n+1].class?`<pre><code>${e[n].replace(/^\t|^ {4}/,"")}`:n===t.length-1||"preInd"!==t[n+1].class&&n>0&&"preInd"===t[n-1].class?`\n${e[n].replace(/^\t|^ {4}/,"")}</code></pre>`:0!==n&&"preInd"===t[n-1].class||n!==t.length-1&&"preInd"===t[n+1].class?void 0:`<pre><code>${e[n].replace(/^\t|^ {4}/,"")}</code></pre>`}async function f(e,t,n,l){if(l>0&&"table"===t[l-1].class&&l<t.length-1&&"table"===t[l+1].class){if(n[t[l].tableGrp].hLinePosition===t[l].rowNum+1)return`${m(e,t,n,l)}</thead>`;if(n[t[l].tableGrp].hLinePosition===t[l].rowNum)return`<tbody>${m(e,t,n,l)}`;if(n[t[l].tableGrp].hLinePosition!==t[l].rowNum+1&&n[t[l].tableGrp].hLinePosition!==t[l].rowNum)return`${m(e,t,n,l)}`}if((0===l||"table"!==t[l-1].class)&&l<t.length&&"table"===t[l+1].class){if(0===n[t[l].tableGrp].hLinePosition)return`<table><tbody>${m(e,t,n,l)}`;if(1===n[t[l].tableGrp].hLinePosition)return`<table><thead>${m(e,t,n,l)}</thead>`;if(n[t[l].tableGrp].hLinePosition>1)return`<table><thead>${m(e,t,n,l)}`}if((l===t.length-1||"table"!==t[l+1].class)&&l>0&&"table"===t[l-1].class){if(n[t[l].tableGrp].hLinePosition===t[l].rowNum+1)return`${m(e,t,n,l)}</thead></table>`;if(n[t[l].tableGrp].hLinePosition===t[l].rowNum)return`<tbody>${m(e,t,n,l)}</tbody></table>`;if(n[t[l].tableGrp].hLinePosition!==t[l].rowNum+1&&n[t[l].tableGrp].hLinePosition!==t[l].rowNum)return`${m(e,t,n,l)}</tbody></table>`}if(!(0!==l&&"table"===t[l-1].class||l!==t.length-1&&"table"===t[l+1].class)){if(n[t[l].tableGrp].hLinePosition===l-t[l].tableGrp+1)return`<table><thead>${m(e,t,n,l)}</thead></table>`;if(n[t[l].tableGrp].hLinePosition===l-t[l].tableGrp)return`<table><tbody>${m(e,t,n,l)}</tbody></table>`}}function k(e){let t=e.split("|");return t.splice(1,t.length-2).map(e=>!0===/^ ?:-+ ?$/.test(e)?"left":!0===/^ ?:-+: ?$/.test(e)?"center":!0===/^ ?-+: ?$/.test(e)?"right":!0===/^ ?-+ ?$/.test(e)?"":void 0)}function m(e,t,n,l){let r=e[l].split(/[ \t]*(?<!\\)\|[ \t]*/);return"<tr>"+r.splice(1,r.length-2).map((e,r)=>`<td ${n[t[l].tableGrp].align[r]}>${e}</td>`).join("")+"</tr>"}let G=[],w=!1,_=[],L='<svg class="user-cnt-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0, 0, 16, 21"><path d="M 0,0 V 2 h 8 c 3,0 6,3 6,6 0,3 -3,6 -6,6 H 7 v 2 h 1 c 4,0 8,-4 8,-8 0,-4 -4,-8 -8,-8 z"/><path d="M 6,21 7,19 3,15 7,11 6,9 0,15 Z"/></svg>';return n(e.replace(/  $/gm,"<br>").split(/\r?\n/)).then(e=>l(e)).then(e=>a(e)).then(e=>c(e)).then(e=>i(e))}